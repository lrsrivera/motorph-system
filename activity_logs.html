<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Logs - MotorPH</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="icon" href="data:,">
</head>
<body class="dashboard-body">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <img src="assets/images/motorph_logo_with _white_outline.png" alt="MotorPH" class="header-logo">
        </div>
        <div class="header-right">
            <div class="employee-profile">
                <div class="profile-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" fill="white"/>
                        <path d="M12 14C7.58172 14 4 17.5817 4 22H20C20 17.5817 16.4183 14 12 14Z" fill="white"/>
                    </svg>
                </div>
                <div class="employee-info">
                    <span class="employee-name">Andrea Mae Villanueva</span>
                    <div class="badges">
                        <span class="badge badge-role">HR Manager</span>
                        <span class="badge badge-empno">10006</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Managerial Dashboard</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="manager_dashboard.html" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>My Attendance</span>
                </a>
                <a href="manager_requests.html" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H16M12 8V16M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>My Requests</span>
                </a>
                <a href="manager_payslip.html" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9 9H15M9 13H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>My Payslip</span>
                </a>
                <a href="team_attendance.html" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Team Attendance</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H16M12 8V16M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Team Requests</span>
                </a>
                <a href="employee_details.html" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Employee Details</span>
                </a>
                <a href="manager_about.html" class="nav-item">
                    <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>About Me</span>
                </a>
            </nav>
            <button class="logout-btn" onclick="window.location.href='index.html'">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12L16 7M21 12H9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Log Out
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="activity-logs-container">
                <!-- Compact Header -->
                <div class="page-header-compact">
                    <button class="back-btn" onclick="goBack()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <h1 class="page-title-compact">Activity Logs</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary btn-sm" id="exportLogsBtn">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M17 9L12 14M12 14L7 9M12 14V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>

                <!-- Compact Filters -->
                <div class="filters-compact">
                    <div class="filters-compact-left">
                        <div class="filter-group-compact">
                            <input type="date" id="startDate" class="filter-input-compact" placeholder="From">
                            <span class="date-separator">to</span>
                            <input type="date" id="endDate" class="filter-input-compact" placeholder="To">
                        </div>
                        <div class="filter-group-compact">
                            <select id="actionFilter" class="filter-select-compact">
                                <option value="">All Actions</option>
                                <option value="Update">Update</option>
                                <option value="Delete">Delete</option>
                                <option value="Add">Add</option>
                            </select>
                        </div>
                        <div class="filter-group-compact">
                            <select id="managerFilter" class="filter-select-compact">
                                <option value="">All Managers</option>
                                <option value="Andrea Mae Villanueva">Andrea Mae Villanueva</option>
                            </select>
                        </div>
                    </div>
                    <div class="filters-compact-right">
                        <button class="btn btn-secondary btn-sm archives-btn" id="archivesBtn" onclick="openArchivesModal()" title="View archived employees">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5 8H19M8 8V6C8 5.46957 8.21071 4.96086 8.58579 4.58579C8.96086 4.21071 9.46957 4 10 4H14C14.5304 4 15.0391 4.21071 15.4142 4.58579C15.7893 4.96086 16 5.46957 16 6V8M10 12V16M14 12V16M5 8V20C5 20.5304 5.21071 21.0391 5.58579 21.4142C5.96086 21.7893 6.46957 22 7 22H17C17.5304 22 18.0391 21.7893 18.4142 21.4142C18.7893 21.0391 19 20.5304 19 20V8H5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Archives
                        </button>
                    </div>
                </div>

                <!-- Compact Activity Logs Table -->
                <div class="logs-table-container-compact">
                    <div class="table-header-compact">
                        <span class="table-count" id="logCount">0 entries</span>
                    </div>
                    
                    <div class="table-container-compact">
                        <table class="activity-logs-table-compact" id="activityLogsTable">
                            <thead>
                                <tr>
                                    <th class="col-timestamp">Time</th>
                                    <th class="col-action">Action</th>
                                    <th class="col-employee">Employee</th>
                                    <th class="col-field">Field</th>
                                    <th class="col-from">From</th>
                                    <th class="col-to">To</th>
                                    <th class="col-reason">Reason</th>
                                </tr>
                            </thead>
                            <tbody id="activityLogsTableBody">
                                <!-- Log entries will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Archives Modal -->
    <div class="modal-overlay" id="archivesModal" style="display: none;">
        <div class="modal-content archives-modal-content">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title">Archived Employees</h3>
                    <p class="modal-subtitle">View and manage archived records.</p>
                </div>
                <button class="modal-close" onclick="closeArchivesModal()" aria-label="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="archives-modal-body">
                <div class="archives-controls">
                    <div class="archives-search-container">
                        <input type="text" id="archivesSearch" class="form-input archives-search" placeholder="Search name, ID, position..." aria-label="Search archived employees">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="archives-filter-container">
                        <label for="archivesStatusFilter" class="archives-filter-label">Filter by Status:</label>
                        <select id="archivesStatusFilter" class="form-select archives-status-filter" aria-label="Filter by status">
                            <option value="">All</option>
                            <option value="Resigned">Resigned</option>
                            <option value="Terminated">Terminated</option>
                            <option value="End of Contract">End of Contract</option>
                        </select>
                    </div>
                </div>
                <div class="archives-table-container">
                    <div class="archives-table-wrapper">
                        <table class="archives-table" id="archivesTable">
                            <thead>
                                <tr>
                                    <th class="archives-th sortable-archive" data-sort="employeeNumber">Employee #</th>
                                    <th class="archives-th sortable-archive" data-sort="name">Name</th>
                                    <th class="archives-th sortable-archive" data-sort="position">Position</th>
                                    <th class="archives-th sortable-archive" data-sort="department">Department</th>
                                    <th class="archives-th sortable-archive" data-sort="archiveDate">Archive Date</th>
                                    <th class="archives-th">Reason</th>
                                    <th class="archives-th">Status</th>
                                    <th class="archives-th">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="archivesTableBody">
                                <!-- Archived employees will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="archives-empty-state" id="archivesEmptyState" style="display: none;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 8H19M8 8V6C8 5.46957 8.21071 4.96086 8.58579 4.58579C8.96086 4.21071 9.46957 4 10 4H14C14.5304 4 15.0391 4.21071 15.4142 4.58579C15.7893 4.96086 16 5.46957 16 6V8M10 12V16M14 12V16M5 8V20C5 20.5304 5.21071 21.0391 5.58579 21.4142C5.96086 21.7893 6.46957 22 7 22H17C17.5304 22 18.0391 21.7893 18.4142 21.4142C18.7893 21.0391 19 20.5304 19 20V8H5Z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <p>No archived employees match your filters.</p>
                        <button class="btn btn-link" onclick="clearArchivesFilters()">Clear Filters</button>
                    </div>
                </div>
            </div>
            <div class="archives-modal-footer">
                <button class="btn btn-secondary" onclick="closeArchivesModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- HR Credentials Modal for Reactivate -->
    <div id="archivesHrCredentialsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">HR Authorization Required</h3>
                <button class="modal-close" onclick="closeArchivesHrModal()" aria-label="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="credentials-info">
                <button class="credentials-toggle-btn" onclick="toggleArchivesCredentials()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="btn-text">Show Test Credentials</span>
                </button>
                <div class="credentials-display" id="archivesCredentialsDisplay" style="display: none;">
                    <div class="credentials-content">
                        <strong>Test Credentials:</strong>
                        <div class="credential-item">
                            <span class="credential-label">Username:</span>
                            <code class="credential-value">hr_admin</code>
                        </div>
                        <div class="credential-item">
                            <span class="credential-label">Password:</span>
                            <code class="credential-value">password</code>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <p>Please enter your HR credentials to reactivate this employee:</p>
                <div class="form-group">
                    <label class="form-label" for="archivesHrUsername">Username:</label>
                    <input type="text" class="form-input" id="archivesHrUsername" placeholder="Enter HR username">
                </div>
                <div class="form-group">
                    <label class="form-label" for="archivesHrPassword">Password:</label>
                    <input type="password" class="form-input" id="archivesHrPassword" placeholder="Enter HR password">
                </div>
                <div id="archivesHrCredentialsError" class="error-message" style="display: none;">
                    Invalid HR credentials. Only HR can reactivate employees.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeArchivesHrModal()">Cancel</button>
                <button class="btn btn-primary" onclick="verifyArchivesHrCredentials()">Verify</button>
            </div>
        </div>
    </div>

    <!-- Reactivate Confirmation Modal -->
    <div class="modal-overlay" id="reactivateConfirmModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Reactivate Employee?</h3>
                <button class="modal-close" onclick="closeReactivateModal()" aria-label="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p>This will return the employee to the active directory. This is a front-end preview only.</p>
                <div class="employee-info-preview" id="reactivateEmployeeInfo">
                    <!-- Employee info will be populated here -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeReactivateModal()">Close</button>
                <button class="btn btn-primary" id="confirmReactivateBtn">Reactivate</button>
            </div>
        </div>
    </div>

    <script src="assets/app.js"></script>
    <script>
        // Sample activity log data (same as in employee_details.html)
        let activityLogs = [
            {
                id: 1,
                timestamp: "2024-04-25 10:30:00",
                managerName: "Andrea Mae Villanueva",
                action: "Update",
                employeeName: "Manuel Garcia",
                employeeNumber: "10001",
                fieldChanged: "Basic Salary",
                oldValue: "140000",
                newValue: "150000",
                reason: "Annual salary increase"
            },
            {
                id: 2,
                timestamp: "2024-04-24 14:15:00",
                managerName: "Andrea Mae Villanueva",
                action: "Update",
                employeeName: "Antonio Lim",
                employeeNumber: "10003",
                fieldChanged: "Status",
                oldValue: "Probationary",
                newValue: "Regular",
                reason: "Probation period completed successfully"
            },
            {
                id: 3,
                timestamp: "2024-04-23 09:45:00",
                managerName: "Andrea Mae Villanueva",
                action: "Update",
                employeeName: "Jennifer Reyes",
                employeeNumber: "10004",
                fieldChanged: "Phone Number",
                oldValue: "09123456791",
                newValue: "09123456792",
                reason: "Employee requested phone number update"
            },
            {
                id: 4,
                timestamp: "2024-04-22 16:20:00",
                managerName: "Andrea Mae Villanueva",
                action: "Update",
                employeeName: "Anthony Salcedo",
                employeeNumber: "10005",
                fieldChanged: "Position",
                oldValue: "Junior Accountant",
                newValue: "Accountant",
                reason: "Promotion approved"
            },
            {
                id: 5,
                timestamp: "2024-04-21 11:10:00",
                managerName: "Andrea Mae Villanueva",
                action: "Update",
                employeeName: "Andrea Mae Villanueva",
                employeeNumber: "10006",
                fieldChanged: "Basic Salary",
                oldValue: "50000",
                newValue: "52670",
                reason: "Salary adjustment for HR Manager role"
            }
        ];

        let filteredLogs = [...activityLogs];

        // Archived employees data
        let archivedEmployees = [
            {
                id: 1,
                employeeNumber: "10011",
                firstName: "John",
                lastName: "Smith",
                name: "John Smith",
                position: "Software Engineer",
                department: "IT",
                archiveDate: "2024-03-15",
                reason: "End of contract period",
                status: "End of Contract"
            },
            {
                id: 2,
                employeeNumber: "10012",
                firstName: "Maria",
                lastName: "Santos",
                name: "Maria Santos",
                position: "Marketing Coordinator",
                department: "Marketing",
                archiveDate: "2024-02-28",
                reason: "Resigned for personal reasons",
                status: "Resigned"
            },
            {
                id: 3,
                employeeNumber: "10013",
                firstName: "Robert",
                lastName: "Chen",
                name: "Robert Chen",
                position: "Sales Representative",
                department: "Sales",
                archiveDate: "2024-01-20",
                reason: "Terminated due to policy violation",
                status: "Terminated"
            },
            {
                id: 4,
                employeeNumber: "10014",
                firstName: "Sarah",
                lastName: "Gonzalez",
                name: "Sarah Gonzalez",
                position: "Customer Support",
                department: "Operations",
                archiveDate: "2024-03-10",
                reason: "End of contract period",
                status: "End of Contract"
            },
            {
                id: 5,
                employeeNumber: "10015",
                firstName: "Michael",
                lastName: "Tan",
                name: "Michael Tan",
                position: "Accountant",
                department: "Finance",
                archiveDate: "2024-02-15",
                reason: "Resigned for better opportunity",
                status: "Resigned"
            },
            {
                id: 6,
                employeeNumber: "10016",
                firstName: "Lisa",
                lastName: "Anderson",
                name: "Lisa Anderson",
                position: "HR Assistant",
                department: "Human Resources",
                archiveDate: "2024-01-05",
                reason: "Terminated due to performance issues",
                status: "Terminated"
            },
            {
                id: 7,
                employeeNumber: "10017",
                firstName: "David",
                lastName: "Wilson",
                name: "David Wilson",
                position: "Operations Manager",
                department: "Operations",
                archiveDate: "2024-03-22",
                reason: "End of contract period",
                status: "End of Contract"
            },
            {
                id: 8,
                employeeNumber: "10018",
                firstName: "Emily",
                lastName: "Martinez",
                name: "Emily Martinez",
                position: "Graphic Designer",
                department: "Marketing",
                archiveDate: "2024-02-10",
                reason: "Resigned - relocation",
                status: "Resigned"
            },
            {
                id: 9,
                employeeNumber: "10019",
                firstName: "James",
                lastName: "Lee",
                name: "James Lee",
                position: "Data Analyst",
                department: "IT",
                archiveDate: "2024-01-30",
                reason: "Terminated due to misconduct",
                status: "Terminated"
            },
            {
                id: 10,
                employeeNumber: "10020",
                firstName: "Jessica",
                lastName: "Brown",
                name: "Jessica Brown",
                position: "Administrative Assistant",
                department: "Administration",
                archiveDate: "2024-03-05",
                reason: "End of contract period",
                status: "End of Contract"
            }
        ];

        let filteredArchivedEmployees = [...archivedEmployees];
        let pendingReactivateEmployeeId = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateActivityLogsTable();
            populateArchivesTable();
            setupEventListeners();
            updateLogCount();
        });

        function populateActivityLogsTable() {
            const tbody = document.getElementById('activityLogsTableBody');
            tbody.innerHTML = '';

            filteredLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="col-timestamp">${formatTimestampCompact(log.timestamp)}</td>
                    <td class="col-action"><span class="action-badge-compact action-${log.action.toLowerCase()}">${log.action}</span></td>
                    <td class="col-employee">${log.employeeName}</td>
                    <td class="col-field">${log.fieldChanged}</td>
                    <td class="col-from">${log.oldValue}</td>
                    <td class="col-to">${log.newValue}</td>
                    <td class="col-reason">${log.reason}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function setupEventListeners() {
            // Filter controls
            document.getElementById('startDate').addEventListener('change', applyFilters);
            document.getElementById('endDate').addEventListener('change', applyFilters);
            document.getElementById('actionFilter').addEventListener('change', applyFilters);
            document.getElementById('managerFilter').addEventListener('change', applyFilters);

            // Control buttons
            document.getElementById('exportLogsBtn').addEventListener('click', function() {
                // Non-functional export button - just show a message
                alert('Export functionality is not implemented in this prototype.');
            });

            // Archives modal controls
            document.getElementById('archivesSearch').addEventListener('input', applyArchivesFilters);
            document.getElementById('archivesStatusFilter').addEventListener('change', applyArchivesFilters);
            
            // Archives table sorting
            document.querySelectorAll('.sortable-archive').forEach(header => {
                header.addEventListener('click', function() {
                    const column = this.getAttribute('data-sort');
                    sortArchivesTable(column);
                });
            });

            // Reactivate confirmation
            document.getElementById('confirmReactivateBtn').addEventListener('click', confirmReactivateEmployee);

            // Close modals on overlay click
            document.getElementById('archivesModal').addEventListener('click', function(e) {
                if (e.target === this) closeArchivesModal();
            });
            document.getElementById('archivesHrCredentialsModal').addEventListener('click', function(e) {
                if (e.target === this) closeArchivesHrModal();
            });
            document.getElementById('reactivateConfirmModal').addEventListener('click', function(e) {
                if (e.target === this) closeReactivateModal();
            });

            // ESC key to close modals
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const archivesModal = document.getElementById('archivesModal');
                    const hrModal = document.getElementById('archivesHrCredentialsModal');
                    const reactivateModal = document.getElementById('reactivateConfirmModal');
                    
                    if (reactivateModal && reactivateModal.style.display !== 'none') {
                        closeReactivateModal();
                    } else if (hrModal && hrModal.style.display !== 'none') {
                        closeArchivesHrModal();
                    } else if (archivesModal && archivesModal.style.display !== 'none') {
                        closeArchivesModal();
                    }
                }
            });
        }

        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const actionFilter = document.getElementById('actionFilter').value;
            const managerFilter = document.getElementById('managerFilter').value;

            filteredLogs = activityLogs.filter(log => {
                // Date filter
                if (startDate && log.timestamp < startDate) return false;
                if (endDate && log.timestamp > endDate + ' 23:59:59') return false;

                // Action filter
                if (actionFilter && log.action !== actionFilter) return false;

                // Manager filter
                if (managerFilter && log.managerName !== managerFilter) return false;

                return true;
            });

            populateActivityLogsTable();
            updateLogCount();
        }


        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function formatTimestampCompact(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('en-US', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }

        function updateLogCount() {
            const count = filteredLogs.length;
            document.getElementById('logCount').textContent = `${count} entr${count === 1 ? 'y' : 'ies'}`;
        }

        function goBack() {
            window.location.href = 'employee_details.html';
        }

        // Archives Modal Functions
        function openArchivesModal() {
            document.getElementById('archivesModal').style.display = 'flex';
            populateArchivesTable();
        }

        function closeArchivesModal() {
            document.getElementById('archivesModal').style.display = 'none';
        }

        function populateArchivesTable() {
            const tbody = document.getElementById('archivesTableBody');
            const emptyState = document.getElementById('archivesEmptyState');
            tbody.innerHTML = '';

            if (filteredArchivedEmployees.length === 0) {
                emptyState.style.display = 'flex';
                return;
            }

            emptyState.style.display = 'none';

            filteredArchivedEmployees.forEach(employee => {
                const row = document.createElement('tr');
                const statusClass = employee.status.toLowerCase().replace(/\s+/g, '-');
                let statusColor = '#6b7280';
                let statusBg = '#f3f4f6';
                
                if (employee.status === 'Resigned') {
                    statusColor = '#f59e0b';
                    statusBg = '#fef3c7';
                } else if (employee.status === 'Terminated') {
                    statusColor = '#ef4444';
                    statusBg = '#fee2e2';
                }

                row.innerHTML = `
                    <td>${employee.employeeNumber}</td>
                    <td>${employee.name}</td>
                    <td>${employee.position}</td>
                    <td>${employee.department}</td>
                    <td>${formatArchiveDate(employee.archiveDate)}</td>
                    <td>${employee.reason}</td>
                    <td>
                        <span class="archives-status-badge" style="background: ${statusBg}; color: ${statusColor};">
                            ${employee.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="initiateReactivate(${employee.id})">
                            Reactivate
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function formatArchiveDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function applyArchivesFilters() {
            const searchTerm = document.getElementById('archivesSearch').value.toLowerCase();
            const statusFilter = document.getElementById('archivesStatusFilter').value;

            filteredArchivedEmployees = archivedEmployees.filter(employee => {
                const matchesSearch = !searchTerm || 
                    employee.name.toLowerCase().includes(searchTerm) ||
                    employee.employeeNumber.includes(searchTerm) ||
                    employee.position.toLowerCase().includes(searchTerm) ||
                    employee.department.toLowerCase().includes(searchTerm);

                const matchesStatus = !statusFilter || employee.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            populateArchivesTable();
        }

        function clearArchivesFilters() {
            document.getElementById('archivesSearch').value = '';
            document.getElementById('archivesStatusFilter').value = '';
            applyArchivesFilters();
        }

        let archivesSortColumn = null;
        let archivesSortDirection = 'asc';

        function sortArchivesTable(column) {
            const direction = archivesSortColumn === column && archivesSortDirection === 'asc' ? 'desc' : 'asc';
            archivesSortColumn = column;
            archivesSortDirection = direction;

            filteredArchivedEmployees.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                if (column === 'name') {
                    aVal = a.name.toLowerCase();
                    bVal = b.name.toLowerCase();
                } else if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            populateArchivesTable();
        }

        function initiateReactivate(employeeId) {
            pendingReactivateEmployeeId = employeeId;
            openArchivesHrModal();
        }

        function openArchivesHrModal() {
            document.getElementById('archivesHrCredentialsModal').style.display = 'flex';
            document.getElementById('archivesHrCredentialsError').style.display = 'none';
            document.getElementById('archivesHrUsername').value = '';
            document.getElementById('archivesHrPassword').value = '';
        }

        function closeArchivesHrModal() {
            document.getElementById('archivesHrCredentialsModal').style.display = 'none';
            pendingReactivateEmployeeId = null;
        }

        function toggleArchivesCredentials() {
            const display = document.getElementById('archivesCredentialsDisplay');
            const btn = document.querySelector('#archivesHrCredentialsModal .credentials-toggle-btn .btn-text');
            
            if (display.style.display === 'none') {
                display.style.display = 'block';
                btn.textContent = 'Hide Test Credentials';
            } else {
                display.style.display = 'none';
                btn.textContent = 'Show Test Credentials';
            }
        }

        function verifyArchivesHrCredentials() {
            const username = document.getElementById('archivesHrUsername').value;
            const password = document.getElementById('archivesHrPassword').value;
            const errorDiv = document.getElementById('archivesHrCredentialsError');

            if (username === 'hr_admin' && password === 'password') {
                closeArchivesHrModal();
                showReactivateConfirmation();
            } else {
                errorDiv.style.display = 'block';
            }
        }

        function showReactivateConfirmation() {
            const employee = archivedEmployees.find(emp => emp.id === pendingReactivateEmployeeId);
            if (!employee) return;

            const content = `
                <div class="employee-preview">
                    <strong>${employee.name}</strong><br>
                    Employee #${employee.employeeNumber}<br>
                    Position: ${employee.position}
                </div>
            `;

            document.getElementById('reactivateEmployeeInfo').innerHTML = content;
            document.getElementById('reactivateConfirmModal').style.display = 'flex';
        }

        function closeReactivateModal() {
            document.getElementById('reactivateConfirmModal').style.display = 'none';
            pendingReactivateEmployeeId = null;
        }

        function confirmReactivateEmployee() {
            if (!pendingReactivateEmployeeId) return;

            // Remove from archived list for this session (UI-only, no persistence)
            const index = archivedEmployees.findIndex(emp => emp.id === pendingReactivateEmployeeId);
            if (index !== -1) {
                archivedEmployees.splice(index, 1);
                applyArchivesFilters();
                closeReactivateModal();
                showSuccessMessage('Employee reactivated (demo)');
            }
        }

        // Make functions globally available
        window.openArchivesModal = openArchivesModal;
        window.closeArchivesModal = closeArchivesModal;
        window.initiateReactivate = initiateReactivate;
        window.clearArchivesFilters = clearArchivesFilters;
        window.toggleArchivesCredentials = toggleArchivesCredentials;
        window.verifyArchivesHrCredentials = verifyArchivesHrCredentials;
        window.closeArchivesHrModal = closeArchivesHrModal;
        window.closeReactivateModal = closeReactivateModal;
        window.confirmReactivateEmployee = confirmReactivateEmployee;

        function showSuccessMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 16px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                z-index: 1000;
                font-size: 14px;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 8px;
                animation: slideIn 0.3s ease-out;
            `;

            notification.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ${message}
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
